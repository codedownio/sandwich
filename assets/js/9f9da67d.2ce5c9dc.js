"use strict";(self.webpackChunksandwich_site=self.webpackChunksandwich_site||[]).push([[2193],{8791:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>d});var t=s(6070),i=s(6113);const o={id:"command_line",title:"Command line arguments",sidebar_label:"Command line"},a=void 0,r={id:"command_line",title:"Command line arguments",description:"If you use runSandwichWithCommandLineArgs, then you can control your tests with command line arguments. This section contains a quick overview of the available arguments, and explains how you can add your own custom ones.",source:"@site/docs/command_line.md",sourceDirName:".",slug:"/command_line",permalink:"/sandwich/docs/command_line",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/command_line.md",tags:[],version:"current",frontMatter:{id:"command_line",title:"Command line arguments",sidebar_label:"Command line"},sidebar:"docs",previous:{title:"Timing",permalink:"/sandwich/docs/timing"},next:{title:"Test Discovery",permalink:"/sandwich/docs/discovery"}},c={},d=[{value:"Quick reference",id:"quick-reference",level:2},{value:"Custom command line arguments",id:"custom-command-line-arguments",level:2}];function l(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["If you use ",(0,t.jsx)(n.a,{href:"http://hackage.haskell.org/package/sandwich/docs/Test-Sandwich.html#v:runSandwichWithCommandLineArgs",children:"runSandwichWithCommandLineArgs"}),", then you can control your tests with command line arguments. This section contains a quick overview of the available arguments, and explains how you can add your own custom ones."]}),"\n",(0,t.jsx)(n.h2,{id:"quick-reference",children:"Quick reference"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Choose a formatter: ",(0,t.jsx)(n.code,{children:"--tui"}),", ",(0,t.jsx)(n.code,{children:"--print"}),", ",(0,t.jsx)(n.code,{children:"--print-failures"}),", ",(0,t.jsx)(n.code,{children:"--silent"}),", ",(0,t.jsx)(n.code,{children:"--auto"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Choose a default log level: ",(0,t.jsx)(n.code,{children:"--debug"}),", ",(0,t.jsx)(n.code,{children:"--info"}),", ",(0,t.jsx)(n.code,{children:"--warn"}),", ",(0,t.jsx)(n.code,{children:"--error"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Choose a visibility threshold: ",(0,t.jsx)(n.code,{children:"--visibility-threshold N"})," (or ",(0,t.jsx)(n.code,{children:"-v N"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:["Repeat the test suite N times: ",(0,t.jsx)(n.code,{children:"--repeat n"})," (useful to exercise flaky tests)"]}),"\n",(0,t.jsxs)(n.li,{children:["Prunes any nodes (and their children) in the test tree whose label contains a particular string: ",(0,t.jsx)(n.code,{children:"--prune some_string"}),". Pruning happens before filtering, no matter the order of the arguments."]}),"\n",(0,t.jsxs)(n.li,{children:["Filter the test tree to a string: ",(0,t.jsx)(n.code,{children:"--filter some_string"}),". Filtering happens after pruning, no matter the order of the arguments."]}),"\n",(0,t.jsxs)(n.li,{children:["Learn about extra flags controlling extensions: ",(0,t.jsx)(n.code,{children:"--print-slack-flags"}),", ",(0,t.jsx)(n.code,{children:"--print-webdriver-flags"}),", ",(0,t.jsx)(n.code,{children:"--print-quickcheck-flags"}),", ",(0,t.jsx)(n.code,{children:"--print-hedgehog-flags"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["List test modules and flags to run them individually: ",(0,t.jsx)(n.code,{children:"--list-tests"}),". (Requires the use of ",(0,t.jsx)(n.a,{href:"discovery",children:"test discovery"}),".)"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["This list isn't exhaustive; to learn more about shorthands and other options pass ",(0,t.jsx)(n.code,{children:"--help"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"custom-command-line-arguments",children:"Custom command line arguments"}),"\n",(0,t.jsxs)(n.p,{children:["For more complex tests, you may want to be able to control them with custom command line arguments. To do this, you can write your own set of options with ",(0,t.jsx)(n.a,{href:"https://hackage.haskell.org/package/optparse-applicative",children:"optparse-applicative"})," and run your tests with ",(0,t.jsx)(n.a,{href:"http://hackage.haskell.org/package/sandwich/docs/Test-Sandwich.html#v:runSandwichWithCommandLineArgs-39-",children:"runSandwichWithCommandLineArgs'"}),". The primed version accepts your custom options parser."]}),"\n",(0,t.jsxs)(n.p,{children:["This will cause your options to be parsed along with the default ones. To obtain the full command line options inside a test, call ",(0,t.jsx)(n.a,{href:"http://hackage.haskell.org/package/sandwich/docs/Test-Sandwich-Contexts.html#v:getCommandLineOptions",children:"getCommandLineOptions"}),". This will return a ",(0,t.jsx)(n.a,{href:"http://hackage.haskell.org/package/sandwich/docs/Test-Sandwich-Misc.html#t:CommandLineOptions",children:"CommandLineOptions a"}),", where ",(0,t.jsx)(n.code,{children:"a"})," is your custom options type. A convenient helper is ",(0,t.jsx)(n.a,{href:"http://hackage.haskell.org/package/sandwich/docs/Test-Sandwich-Contexts.html#v:getCommandLineOptions",children:"getUserCommandLineOptions"}),", which returns only the ",(0,t.jsx)(n.code,{children:"a"})," without the built-in stuff."]}),"\n",(0,t.jsxs)(n.p,{children:["The example below shows this in action. Note that the type of the top-level spec changes from the usual ",(0,t.jsx)(n.a,{href:"http://hackage.haskell.org/package/sandwich/docs/Test-Sandwich-Misc.html#t:TopSpec",children:"TopSpec"})," to ",(0,t.jsx)(n.a,{href:"http://hackage.haskell.org/package/sandwich/docs/Test-Sandwich-Misc.html#t:TopSpecWithOptions-39-",children:"TopSpecWithOptions' a"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-haskell",metastring:'title="https://github.com/codedownio/sandwich/blob/master/demos/demo-command-line-args/app/Main.hs"',children:'import Options.Applicative\nimport Test.Sandwich\n\ndata MyArgs = MyArgs {\n  myArgsFoo :: String\n  , myArgsBar :: Int\n  }\n\nmyArgsParser :: Parser MyArgs\nmyArgsParser = MyArgs\n  <$> strOption (long "foo" <> help "Value of foo" <> metavar "STRING")\n  <*> option auto (long "bar" <> showDefault <> help "Value of bar" <> value 1 <> metavar "INT")\n\ncommandLineArgsDemo :: TopSpecWithOptions\' MyArgs\ncommandLineArgsDemo = describe "Custom command line args" $ do\n  it "Uses the custom command line args" $ do\n    MyArgs {..} <- getUserCommandLineOptions\n    warn [i|Got foo: #{myArgsFoo}|]\n    warn [i|Got bar: #{myArgsBar}|]\n\nmain :: IO ()\nmain = runSandwichWithCommandLineArgs\' testOptions myArgsParser commandLineArgsDemo\n'})}),"\n",(0,t.jsx)(n.p,{children:"Now we can run this with"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"cd sandwich/sandwich-demos\nstack run demo-command-line-args -- --print --foo asdf --bar 42\n"})}),"\n",(0,t.jsx)(n.p,{children:"and the tests will use our custom values."})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},6113:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>r});var t=s(758);const i={},o=t.createContext(i);function a(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);