"use strict";(self.webpackChunksandwich_site=self.webpackChunksandwich_site||[]).push([[7846],{5175:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>a});var o=t(6070),i=t(6113);const s={id:"sandwich-golden",title:"Golden testing"},d=void 0,r={id:"extensions/sandwich-golden",title:"Golden testing",description:"Sandwich has built-in support for golden testing. Golden testing is a form of unit testing where the desired output is stored in separate file(s), usually checked into your repo. When the tests are run, they invoke your code and compare the output to the file version. A good golden testing framework allows you to easily generate (and re-generate!) the output files.",source:"@site/docs/extensions/sandwich-golden.md",sourceDirName:"extensions",slug:"/extensions/sandwich-golden",permalink:"/sandwich/docs/extensions/sandwich-golden",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/extensions/sandwich-golden.md",tags:[],version:"current",frontMatter:{id:"sandwich-golden",title:"Golden testing"},sidebar:"docs",previous:{title:"Markdown Summary Formatter",permalink:"/sandwich/docs/formatters/markdown_summary"},next:{title:"Hedgehog",permalink:"/sandwich/docs/extensions/sandwich-hedgehog"}},l={},a=[{value:"Usage",id:"usage",level:2},{value:"Updating golden files",id:"updating-golden-files",level:3},{value:"Demo",id:"demo",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"Sandwich has built-in support for golden testing. Golden testing is a form of unit testing where the desired output is stored in separate file(s), usually checked into your repo. When the tests are run, they invoke your code and compare the output to the file version. A good golden testing framework allows you to easily generate (and re-generate!) the output files."}),"\n",(0,o.jsxs)(n.p,{children:["Haddocks can be found ",(0,o.jsx)(n.a,{href:"http://hackage.haskell.org/package/sandwich/docs/Test-Sandwich-Golden.html",children:"here"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,o.jsxs)(n.p,{children:["The main function for working with golden tests is ",(0,o.jsx)(n.a,{href:"http://hackage.haskell.org/package/sandwich/docs/Test-Sandwich-Golden.html#v:golden",children:"golden"}),". It's a simple wrapper around ",(0,o.jsx)(n.a,{href:"http://hackage.haskell.org/package/sandwich/docs/Test-Sandwich.html#v:it",children:"it"})," with some options for the test name and how to read/write the golden file. Using it looks like this:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-haskell",children:'import Test.Sandwich\nimport Test.Sandwich.Golden\n\ngoldenDemo :: TopSpec\ngoldenDemo = describe "Simple tests" $ do\n  describe "myStringFunc" $\n    golden $ goldenString "myStringFunc" (myStringFunc ())\n\nmyStringFunc _ = "foo"\n'})}),"\n",(0,o.jsxs)(n.p,{children:["The first time you run this test, it will generate the directory ",(0,o.jsx)(n.code,{children:"<project root>/.golden"}),", containing the desired outputs. You can then check this into version control."]}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:["You can change the Golden directory from the default by passing ",(0,o.jsx)(n.code,{children:"--golden-dir=/path/to/golden/dir"}),"."]})}),"\n",(0,o.jsxs)(n.p,{children:["Now suppose you're working on your project, and you inadvertently changed the implementation of ",(0,o.jsx)(n.code,{children:"myStringFunc"})," to this:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-haskell",children:'myStringFunc _ = "bar"\n'})}),"\n",(0,o.jsxs)(n.p,{children:["If you run the tests again, this will fail, saying ",(0,o.jsx)(n.code,{children:"myStringFunc"}),' is expected to return "foo" but returned "bar". This is good; the test is enforcing that this value stays golden.']}),"\n",(0,o.jsxs)(n.p,{children:['Once you\'ve run some failing tests, they will also fill in "actual" files alongside the "golden" files in the ',(0,o.jsx)(n.code,{children:".golden"})," dir. You can compare these files to see what changed in the current code."]}),"\n",(0,o.jsx)(n.h3,{id:"updating-golden-files",children:"Updating golden files"}),"\n",(0,o.jsxs)(n.p,{children:['Now suppose we want to update the golden files, so that "bar" becomes the desired output for ',(0,o.jsx)(n.code,{children:"myStringFunc"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["Simply run the tests with the ",(0,o.jsx)(n.code,{children:"--golden-update"})," flag. This will print the files it updates:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"Replacing golden with actual...\n  .golden/myStringFunc/golden <-- .golden/myStringFunc/actual\nDone!\n"})}),"\n",(0,o.jsx)(n.p,{children:"Now you can check the updated golden files into the repo."}),"\n",(0,o.jsx)(n.h2,{id:"demo",children:"Demo"}),"\n",(0,o.jsx)(n.p,{children:"A demo is provided in the Sandwich repo."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"git clone git@github.com:codedownio/sandwich.git\ncd sandwich\nstack run demo-golden -- --print\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},6113:(e,n,t)=>{t.d(n,{R:()=>d,x:()=>r});var o=t(758);const i={},s=o.createContext(i);function d(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);