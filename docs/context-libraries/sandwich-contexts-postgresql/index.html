<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-context-libraries/sandwich-contexts-postgresql" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.3.2">
<title data-rh="true">PostgreSQL | Sandwich</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://codedownio.github.io/sandwich/docs/context-libraries/sandwich-contexts-postgresql"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="PostgreSQL | Sandwich"><meta data-rh="true" name="description" content="The Test.Sandwich.Contexts.PostgreSQL module provides tools for introducing PostgreSQL databases, either via a container (Docker or Podman) or via a raw process (typically obtaining the binary from Nix)."><meta data-rh="true" property="og:description" content="The Test.Sandwich.Contexts.PostgreSQL module provides tools for introducing PostgreSQL databases, either via a container (Docker or Podman) or via a raw process (typically obtaining the binary from Nix)."><link data-rh="true" rel="icon" href="/sandwich/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://codedownio.github.io/sandwich/docs/context-libraries/sandwich-contexts-postgresql"><link data-rh="true" rel="alternate" href="https://codedownio.github.io/sandwich/docs/context-libraries/sandwich-contexts-postgresql" hreflang="en"><link data-rh="true" rel="alternate" href="https://codedownio.github.io/sandwich/docs/context-libraries/sandwich-contexts-postgresql" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/sandwich/blog/rss.xml" title="Sandwich RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/sandwich/blog/atom.xml" title="Sandwich Atom Feed"><link rel="stylesheet" href="/sandwich/assets/css/styles.67d35847.css">
<script src="/sandwich/assets/js/runtime~main.2f61380d.js" defer="defer"></script>
<script src="/sandwich/assets/js/main.476f1093.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_NiiT" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/sandwich/"><div class="navbar__logo"><img src="/sandwich/img/logo.svg" alt="Sandwich" class="themedComponent_ePPg themedComponent--light_A2Ez"><img src="/sandwich/img/logo.svg" alt="Sandwich" class="themedComponent_ePPg themedComponent--dark_Hian"></div><b class="navbar__title text--truncate">Sandwich</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/sandwich/docs/">Docs</a><a class="navbar__item navbar__link" href="/sandwich/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/codedownio/sandwich" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_qMpq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_SWdE colorModeToggle_ZDdf"><button class="clean-btn toggleButton_m3uC toggleButtonDisabled_sCSe" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_jmhg"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_qgNX"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_IG55"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_A4om"><div class="docsWrapper_yYWD"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_bGBf" type="button"></button><div class="docRoot_IVVO"><aside class="theme-doc-sidebar-container docSidebarContainer_ssKN"><div class="sidebarViewport_CxJV"><div class="sidebar_uQEE"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_dLlL"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/sandwich/docs/">Basics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/sandwich/docs/formatters/tui">Formatters</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/sandwich/docs/extensions/sandwich-golden">Extensions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/sandwich/docs/context-libraries/sandwich-contexts">Context libraries</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sandwich/docs/context-libraries/sandwich-contexts">Base contexts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/sandwich/docs/context-libraries/sandwich-contexts-postgresql">PostgreSQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sandwich/docs/context-libraries/sandwich-contexts-smtp">SMTP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sandwich/docs/context-libraries/sandwich-contexts-kubernetes">Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sandwich/docs/context-libraries/sandwich-contexts-minio">MinIO</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_tEpJ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_J1ad"><div class="docItemContainer_Llw1"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_CjKK" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/sandwich/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_NA_A"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Context libraries</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">PostgreSQL</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_Fq3_ theme-doc-toc-mobile tocMobile_a4FT"><button type="button" class="clean-btn tocCollapsibleButton_jMQr">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>PostgreSQL</h1></header><p>The <a href="https://hackage.haskell.org/package/sandwich-contexts/docs/Test-Sandwich-Contexts-PostgreSQL.html" target="_blank" rel="noopener noreferrer">Test.Sandwich.Contexts.PostgreSQL</a> module provides tools for introducing PostgreSQL databases, either via a container (Docker or Podman) or via a raw process (typically obtaining the binary from Nix).</p>
<p>The container method is traditional, but the raw method can be nice because it tends to leave less junk on the system such as container images, networks, and volumes.</p>
<p>This module is currently included in <a href="/sandwich/docs/context-libraries/sandwich-contexts">sandwich-contexts</a>, but may be split into its own package in the future.</p>
<h2 class="anchor anchorWithStickyNavbar_ft1v" id="raw-binary-via-nix">Raw binary via Nix<a href="#raw-binary-via-nix" class="hash-link" aria-label="Direct link to Raw binary via Nix" title="Direct link to Raw binary via Nix">​</a></h2>
<p>Here&#x27;s an example of using a PostgreSQL server using a <a href="/sandwich/docs/context-libraries/sandwich-contexts#nix-contexts">NixContext</a> and <a href="https://hackage.haskell.org/package/sandwich-contexts/docs/Test-Sandwich-Contexts-PostgreSQL.html#v:introducePostgresViaNix" target="_blank" rel="noopener noreferrer">introducePostgresViaNix</a>.</p>
<div class="language-haskell codeBlockContainer_U6bZ theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_sUAJ">https://github.com/codedownio/sandwich/blob/master/demos/demo-postgres/app/Main.hs</div><div class="codeBlockContent_I3XA"><pre tabindex="0" class="prism-code language-haskell codeBlock_jAeK thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_XajP"><span class="token-line" style="color:#bfc7d5"><span class="token import-statement keyword" style="font-style:italic">import</span><span class="token import-statement"> Database</span><span class="token import-statement punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token import-statement">PostgreSQL</span><span class="token import-statement punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token import-statement">Simple</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">Only</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token hvariable">connectPostgreSQL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token hvariable">query_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token import-statement keyword" style="font-style:italic">import</span><span class="token import-statement"> Test</span><span class="token import-statement punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token import-statement">Sandwich</span><span class="token import-statement punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token import-statement">Contexts</span><span class="token import-statement punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token import-statement">PostgreSQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token hvariable">spec</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">TopSpec</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token hvariable">spec</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token hvariable">describe</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Introducing PostgreSQL via Nix&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">introduceNixContext</span><span class="token plain"> </span><span class="token hvariable">nixpkgsReleaseDefault</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token hvariable">introducePostgresViaNix</span><span class="token plain"> </span><span class="token hvariable">defaultPostgresNixOptions</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token hvariable">it</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;runs a simple query&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token constant" style="color:rgb(130, 170, 255)">PostgresContext</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token operator" style="color:rgb(137, 221, 255)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;-</span><span class="token plain"> </span><span class="token hvariable">getContext</span><span class="token plain"> </span><span class="token hvariable">postgres</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token hvariable">conn</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;-</span><span class="token plain"> </span><span class="token hvariable">connectPostgreSQL</span><span class="token plain"> </span><span class="token hvariable">connString</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token constant" style="color:rgb(130, 170, 255)">Only</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;-</span><span class="token plain"> </span><span class="token hvariable">query_</span><span class="token plain"> </span><span class="token hvariable">conn</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;select 2 + 2&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">`shouldBe`</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><br></span></code></pre><div class="buttonGroup_fUqw"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_xOtH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SKyo"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_vKap"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_ft1v" id="container">Container<a href="#container" class="hash-link" aria-label="Direct link to Container" title="Direct link to Container">​</a></h2>
<p>Here&#x27;s an example of using a container via <a href="https://hackage.haskell.org/package/sandwich-contexts/docs/Test-Sandwich-Contexts-PostgreSQL.html#v:introducePostgresViaContainer" target="_blank" rel="noopener noreferrer">introducePostgresViaContainer</a>. You can configure the container options using <a href="https://hackage.haskell.org/package/sandwich-contexts/docs/Test-Sandwich-Contexts-PostgreSQL.html#t:PostgresContainerOptions" target="_blank" rel="noopener noreferrer">PostgresContainerOptions</a>.</p>
<div class="language-haskell codeBlockContainer_U6bZ theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_sUAJ">https://github.com/codedownio/sandwich/blob/master/demos/demo-postgres/app/Main.hs</div><div class="codeBlockContent_I3XA"><pre tabindex="0" class="prism-code language-haskell codeBlock_jAeK thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_XajP"><span class="token-line" style="color:#bfc7d5"><span class="token import-statement keyword" style="font-style:italic">import</span><span class="token import-statement"> Database</span><span class="token import-statement punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token import-statement">PostgreSQL</span><span class="token import-statement punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token import-statement">Simple</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">Only</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token hvariable">connectPostgreSQL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token hvariable">query_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token import-statement keyword" style="font-style:italic">import</span><span class="token import-statement"> Test</span><span class="token import-statement punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token import-statement">Sandwich</span><span class="token import-statement punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token import-statement">Contexts</span><span class="token import-statement punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token import-statement">PostgreSQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token hvariable">spec</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">TopSpec</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token hvariable">spec</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token hvariable">describe</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Introducing PostgreSQL via container&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">introducePostgresViaContainer</span><span class="token plain"> </span><span class="token hvariable">defaultPostgresContainerOptions</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token hvariable">it</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;runs a simple query&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token constant" style="color:rgb(130, 170, 255)">PostgresContext</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token operator" style="color:rgb(137, 221, 255)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;-</span><span class="token plain"> </span><span class="token hvariable">getContext</span><span class="token plain"> </span><span class="token hvariable">postgres</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token hvariable">conn</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;-</span><span class="token plain"> </span><span class="token hvariable">connectPostgreSQL</span><span class="token plain"> </span><span class="token hvariable">connString</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token constant" style="color:rgb(130, 170, 255)">Only</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;-</span><span class="token plain"> </span><span class="token hvariable">query_</span><span class="token plain"> </span><span class="token hvariable">conn</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;select 2 + 2&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">`shouldBe`</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><br></span></code></pre><div class="buttonGroup_fUqw"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_xOtH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SKyo"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_vKap"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_ft1v" id="about-the-use-of-unix-sockets">About the use of Unix sockets<a href="#about-the-use-of-unix-sockets" class="hash-link" aria-label="Direct link to About the use of Unix sockets" title="Direct link to About the use of Unix sockets">​</a></h2>
<p>Starting a Postgres process on a randomly chosen port is tricky, because Postgres currently lacks a setting for choosing its own port and reporting it back to us. So, the only way to start it on a random TCP port is to first manually find a free port on the system and then start Postgres with it. Since this procedure is inherently racy, it can cause failures if your tests are starting lots of Postgres instances (or other network-using processes) in parallel.</p>
<p>This module takes a different approach: it starts the Postgres instance on a Unix socket, which can never fail. You can connect to it via the Unix socket directly if you like. If you use the TCP-based methods like <code>introducePostgresViaNix</code>, they will open a TCP socket inside the test process and then run a proxy to forward packets to the Postgres server&#x27;s Unix socket.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/context-libraries/sandwich-contexts-postgresql.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_gEVS" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_X6Ll"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/sandwich/docs/context-libraries/sandwich-contexts"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Base contexts</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/sandwich/docs/context-libraries/sandwich-contexts-smtp"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">SMTP</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_nnsz thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#raw-binary-via-nix" class="table-of-contents__link toc-highlight">Raw binary via Nix</a></li><li><a href="#container" class="table-of-contents__link toc-highlight">Container</a></li><li><a href="#about-the-use-of-unix-sockets" class="table-of-contents__link toc-highlight">About the use of Unix sockets</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/sandwich/docs/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/sandwich/docs/formatters/slack">Slack integration</a></li><li class="footer__item"><a class="footer__link-item" href="/sandwich/docs/extensions/sandwich-webdriver">Selenium integration</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/codedownio/sandwich/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_qMpq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/sandwich/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/codedownio/sandwich" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_qMpq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Tom McLaughlin. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>