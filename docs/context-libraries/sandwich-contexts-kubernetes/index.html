<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-context-libraries/sandwich-contexts-kubernetes" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.3.2">
<title data-rh="true">Kubernetes | Sandwich</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://codedownio.github.io/sandwich/docs/context-libraries/sandwich-contexts-kubernetes"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Kubernetes | Sandwich"><meta data-rh="true" name="description" content="The sandwich-contexts-kubernetes package provides contexts for creating and managing Kubernetes clusters in your tests, along with utilities for interacting with them."><meta data-rh="true" property="og:description" content="The sandwich-contexts-kubernetes package provides contexts for creating and managing Kubernetes clusters in your tests, along with utilities for interacting with them."><link data-rh="true" rel="icon" href="/sandwich/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://codedownio.github.io/sandwich/docs/context-libraries/sandwich-contexts-kubernetes"><link data-rh="true" rel="alternate" href="https://codedownio.github.io/sandwich/docs/context-libraries/sandwich-contexts-kubernetes" hreflang="en"><link data-rh="true" rel="alternate" href="https://codedownio.github.io/sandwich/docs/context-libraries/sandwich-contexts-kubernetes" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/sandwich/blog/rss.xml" title="Sandwich RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/sandwich/blog/atom.xml" title="Sandwich Atom Feed"><link rel="stylesheet" href="/sandwich/assets/css/styles.67d35847.css">
<script src="/sandwich/assets/js/runtime~main.2f61380d.js" defer="defer"></script>
<script src="/sandwich/assets/js/main.476f1093.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_NiiT" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/sandwich/"><div class="navbar__logo"><img src="/sandwich/img/logo.svg" alt="Sandwich" class="themedComponent_ePPg themedComponent--light_A2Ez"><img src="/sandwich/img/logo.svg" alt="Sandwich" class="themedComponent_ePPg themedComponent--dark_Hian"></div><b class="navbar__title text--truncate">Sandwich</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/sandwich/docs/">Docs</a><a class="navbar__item navbar__link" href="/sandwich/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/codedownio/sandwich" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_qMpq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_SWdE colorModeToggle_ZDdf"><button class="clean-btn toggleButton_m3uC toggleButtonDisabled_sCSe" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_jmhg"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_qgNX"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_IG55"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_A4om"><div class="docsWrapper_yYWD"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_bGBf" type="button"></button><div class="docRoot_IVVO"><aside class="theme-doc-sidebar-container docSidebarContainer_ssKN"><div class="sidebarViewport_CxJV"><div class="sidebar_uQEE"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_dLlL"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/sandwich/docs/">Basics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/sandwich/docs/formatters/tui">Formatters</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/sandwich/docs/extensions/sandwich-golden">Extensions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/sandwich/docs/context-libraries/sandwich-contexts">Context libraries</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sandwich/docs/context-libraries/sandwich-contexts">Base contexts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sandwich/docs/context-libraries/sandwich-contexts-postgresql">PostgreSQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sandwich/docs/context-libraries/sandwich-contexts-smtp">SMTP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/sandwich/docs/context-libraries/sandwich-contexts-kubernetes">Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sandwich/docs/context-libraries/sandwich-contexts-minio">MinIO</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_tEpJ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_J1ad"><div class="docItemContainer_Llw1"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_CjKK" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/sandwich/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_NA_A"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Context libraries</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Kubernetes</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_Fq3_ theme-doc-toc-mobile tocMobile_a4FT"><button type="button" class="clean-btn tocCollapsibleButton_jMQr">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Kubernetes</h1></header><p>The <a href="https://hackage.haskell.org/package/sandwich-contexts-kubernetes" target="_blank" rel="noopener noreferrer">sandwich-contexts-kubernetes</a> package provides contexts for creating and managing Kubernetes clusters in your tests, along with utilities for interacting with them.</p>
<p>This package supports creating clusters using either <a href="https://kind.sigs.k8s.io/" target="_blank" rel="noopener noreferrer">kind</a> or <a href="https://minikube.sigs.k8s.io" target="_blank" rel="noopener noreferrer">Minikube</a>, with binaries obtained either from the system PATH or from Nix. It also includes functions for waiting for pods and services, running kubectl commands, service forwarding, port forwarding, and image management.</p>
<h2 class="anchor anchorWithStickyNavbar_ft1v" id="creating-clusters">Creating clusters<a href="#creating-clusters" class="hash-link" aria-label="Direct link to Creating clusters" title="Direct link to Creating clusters">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_ft1v" id="kind-clusters">Kind clusters<a href="#kind-clusters" class="hash-link" aria-label="Direct link to Kind clusters" title="Direct link to Kind clusters">​</a></h3>
<p><a href="https://kind.sigs.k8s.io/" target="_blank" rel="noopener noreferrer">Kind</a> is a tool for running local Kubernetes clusters using Docker container &quot;nodes.&quot;</p>
<div class="language-haskell codeBlockContainer_U6bZ theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_sUAJ">https://github.com/codedownio/sandwich/blob/master/demos/demo-kubernetes-kind/app/Main.hs</div><div class="codeBlockContent_I3XA"><pre tabindex="0" class="prism-code language-haskell codeBlock_jAeK thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_XajP"><span class="token-line" style="color:#bfc7d5"><span class="token hvariable">spec</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">TopSpec</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token hvariable">spec</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token hvariable">describe</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Introducing a Kubernetes cluster&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">introduceNixContext</span><span class="token plain"> </span><span class="token hvariable">nixpkgsReleaseDefault</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token hvariable">introduceKindClusterViaNix</span><span class="token plain"> </span><span class="token hvariable">defaultKindClusterOptions</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token hvariable">it</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;prints the cluster info&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token hvariable">kcc</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;-</span><span class="token plain"> </span><span class="token hvariable">getContext</span><span class="token plain"> </span><span class="token hvariable">kubernetesCluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token hvariable">info</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token hvariable">i</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token constant" style="color:rgb(130, 170, 255)">Got</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">Kubernetes</span><span class="token plain"> </span><span class="token hvariable">cluster</span><span class="token plain"> </span><span class="token hvariable">context</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">#</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token hvariable">kcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><div class="buttonGroup_fUqw"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_xOtH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SKyo"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_vKap"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can also obtain the <code>kind</code> binary from your system PATH:</p>
<div class="language-haskell codeBlockContainer_U6bZ theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_I3XA"><pre tabindex="0" class="prism-code language-haskell codeBlock_jAeK thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_XajP"><span class="token-line" style="color:#bfc7d5"><span class="token hvariable">spec</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">TopSpec</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token hvariable">spec</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token hvariable">describe</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Kind cluster from environment&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">introduceBinaryViaEnvironment</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">@</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;kind&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token hvariable">introduceBinaryViaEnvironment</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">@</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;kubectl&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token hvariable">introduceKindClusterViaEnvironment</span><span class="token plain"> </span><span class="token hvariable">defaultKindClusterOptions</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- Your tests here</span><br></span></code></pre><div class="buttonGroup_fUqw"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_xOtH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SKyo"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_vKap"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Kind clusters can be configured using <a href="https://hackage.haskell.org/package/sandwich-contexts-kubernetes/docs/Test-Sandwich-Contexts-Kubernetes-KindCluster.html#t:KindClusterOptions" target="_blank" rel="noopener noreferrer">KindClusterOptions</a>:</p>
<ul>
<li><strong>Number of nodes</strong>: Set via <a href="https://hackage.haskell.org/package/sandwich-contexts-kubernetes/docs/Test-Sandwich-Contexts-Kubernetes-KindCluster.html#v:kindClusterNumNodes" target="_blank" rel="noopener noreferrer"><code>kindClusterNumNodes</code></a></li>
<li><strong>Extra flags</strong>: Pass additional kind flags via <a href="https://hackage.haskell.org/package/sandwich-contexts-kubernetes/docs/Test-Sandwich-Contexts-Kubernetes-KindCluster.html#v:kindClusterExtraFlags" target="_blank" rel="noopener noreferrer"><code>kindClusterExtraFlags</code></a></li>
<li><strong>Container labels</strong>: Apply labels to created containers via <a href="https://hackage.haskell.org/package/sandwich-contexts-kubernetes/docs/Test-Sandwich-Contexts-Kubernetes-KindCluster.html#v:kindClusterContainerLabels" target="_blank" rel="noopener noreferrer"><code>kindClusterContainerLabels</code></a></li>
<li><strong>Port mappings</strong>: Expose cluster ports to the host via <a href="https://hackage.haskell.org/package/sandwich-contexts-kubernetes/docs/Test-Sandwich-Contexts-Kubernetes-KindCluster.html#v:kindClusterExtraPortMappings" target="_blank" rel="noopener noreferrer"><code>kindClusterExtraPortMappings</code></a></li>
<li><strong>Mounts</strong>: Mount host directories into cluster nodes via <a href="https://hackage.haskell.org/package/sandwich-contexts-kubernetes/docs/Test-Sandwich-Contexts-Kubernetes-KindCluster.html#v:kindClusterExtraMounts" target="_blank" rel="noopener noreferrer"><code>kindClusterExtraMounts</code></a></li>
<li><strong>Name prefix</strong>: Set cluster name prefix via <a href="https://hackage.haskell.org/package/sandwich-contexts-kubernetes/docs/Test-Sandwich-Contexts-Kubernetes-KindCluster.html#v:kindClusterNamePrefix" target="_blank" rel="noopener noreferrer"><code>kindClusterNamePrefix</code></a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_ft1v" id="minikube-clusters">Minikube clusters<a href="#minikube-clusters" class="hash-link" aria-label="Direct link to Minikube clusters" title="Direct link to Minikube clusters">​</a></h3>
<p><a href="https://minikube.sigs.k8s.io" target="_blank" rel="noopener noreferrer">Minikube</a> runs a single-node Kubernetes cluster locally, supporting various container runtimes.</p>
<div class="language-haskell codeBlockContainer_U6bZ theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_sUAJ">https://github.com/codedownio/sandwich/blob/master/demos/demo-kubernetes-minikube/app/Main.hs</div><div class="codeBlockContent_I3XA"><pre tabindex="0" class="prism-code language-haskell codeBlock_jAeK thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_XajP"><span class="token-line" style="color:#bfc7d5"><span class="token hvariable">spec</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">TopSpec</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token hvariable">spec</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token hvariable">describe</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Introducing a Kubernetes cluster via Minikube&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">introduceNixContext</span><span class="token plain"> </span><span class="token hvariable">nixpkgsReleaseDefault</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token hvariable">introduceMinikubeClusterViaNix</span><span class="token plain"> </span><span class="token hvariable">defaultMinikubeClusterOptions</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token hvariable">it</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;prints the cluster info&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token hvariable">kcc</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;-</span><span class="token plain"> </span><span class="token hvariable">getContext</span><span class="token plain"> </span><span class="token hvariable">kubernetesCluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token hvariable">info</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token hvariable">i</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token constant" style="color:rgb(130, 170, 255)">Got</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">Kubernetes</span><span class="token plain"> </span><span class="token hvariable">cluster</span><span class="token plain"> </span><span class="token hvariable">context</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">#</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token hvariable">kcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><div class="buttonGroup_fUqw"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_xOtH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SKyo"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_vKap"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Similarly, you can use binaries from your environment:</p>
<div class="language-haskell codeBlockContainer_U6bZ theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_I3XA"><pre tabindex="0" class="prism-code language-haskell codeBlock_jAeK thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_XajP"><span class="token-line" style="color:#bfc7d5"><span class="token hvariable">spec</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">TopSpec</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token hvariable">spec</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token hvariable">describe</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Minikube cluster from environment&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">introduceBinaryViaEnvironment</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">@</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;minikube&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token hvariable">introduceBinaryViaEnvironment</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">@</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;kubectl&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token hvariable">introduceMinikubeClusterViaEnvironment</span><span class="token plain"> </span><span class="token hvariable">defaultMinikubeClusterOptions</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- Your tests here</span><br></span></code></pre><div class="buttonGroup_fUqw"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_xOtH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SKyo"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_vKap"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Minikube clusters can be configured using <a href="https://hackage.haskell.org/package/sandwich-contexts-kubernetes/docs/Test-Sandwich-Contexts-Kubernetes-MinikubeCluster.html#t:MinikubeClusterOptions" target="_blank" rel="noopener noreferrer">MinikubeClusterOptions</a>:</p>
<ul>
<li><strong>Number of nodes</strong>: Set via <a href="https://hackage.haskell.org/package/sandwich-contexts-kubernetes/docs/Test-Sandwich-Contexts-Kubernetes-MinikubeCluster.html#v:minikubeClusterNumNodes" target="_blank" rel="noopener noreferrer"><code>minikubeClusterNumNodes</code></a></li>
<li><strong>Extra flags</strong>: Pass additional minikube flags via <a href="https://hackage.haskell.org/package/sandwich-contexts-kubernetes/docs/Test-Sandwich-Contexts-Kubernetes-MinikubeCluster.html#v:minikubeClusterExtraFlags" target="_blank" rel="noopener noreferrer"><code>minikubeClusterExtraFlags</code></a></li>
<li><strong>Name prefix</strong>: Set cluster name prefix via <a href="https://hackage.haskell.org/package/sandwich-contexts-kubernetes/docs/Test-Sandwich-Contexts-Kubernetes-MinikubeCluster.html#v:minikubeClusterNamePrefix" target="_blank" rel="noopener noreferrer"><code>minikubeClusterNamePrefix</code></a></li>
<li><strong>Driver</strong>: Choose container runtime via <a href="https://hackage.haskell.org/package/sandwich-contexts-kubernetes/docs/Test-Sandwich-Contexts-Kubernetes-MinikubeCluster.html#v:minikubeClusterDriver" target="_blank" rel="noopener noreferrer"><code>minikubeClusterDriver</code></a> (docker, podman, etc.)</li>
<li><strong>CPUs</strong>: Set CPU allocation via <a href="https://hackage.haskell.org/package/sandwich-contexts-kubernetes/docs/Test-Sandwich-Contexts-Kubernetes-MinikubeCluster.html#v:minikubeClusterCpus" target="_blank" rel="noopener noreferrer"><code>minikubeClusterCpus</code></a></li>
<li><strong>Memory</strong>: Set memory allocation via <a href="https://hackage.haskell.org/package/sandwich-contexts-kubernetes/docs/Test-Sandwich-Contexts-Kubernetes-MinikubeCluster.html#v:minikubeClusterMemory" target="_blank" rel="noopener noreferrer"><code>minikubeClusterMemory</code></a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_ft1v" id="working-with-clusters">Working with clusters<a href="#working-with-clusters" class="hash-link" aria-label="Direct link to Working with clusters" title="Direct link to Working with clusters">​</a></h2>
<p>Once you have a cluster, you can access its context:</p>
<div class="language-haskell codeBlockContainer_U6bZ theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_I3XA"><pre tabindex="0" class="prism-code language-haskell codeBlock_jAeK thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_XajP"><span class="token-line" style="color:#bfc7d5"><span class="token hvariable">it</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;uses cluster context&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">kcc</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;-</span><span class="token plain"> </span><span class="token hvariable">getContext</span><span class="token plain"> </span><span class="token hvariable">kubernetesCluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">info</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token hvariable">i</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token constant" style="color:rgb(130, 170, 255)">Cluster</span><span class="token plain"> </span><span class="token hvariable">name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">#</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token hvariable">kubernetesClusterName</span><span class="token plain"> </span><span class="token hvariable">kcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">info</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token hvariable">i</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token constant" style="color:rgb(130, 170, 255)">Kubeconfig</span><span class="token plain"> </span><span class="token hvariable">path</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">#</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token hvariable">kubernetesClusterKubeConfigPath</span><span class="token plain"> </span><span class="token hvariable">kcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">info</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token hvariable">i</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token constant" style="color:rgb(130, 170, 255)">Number</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> </span><span class="token hvariable">nodes</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">#</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token hvariable">kubernetesClusterNumNodes</span><span class="token plain"> </span><span class="token hvariable">kcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><div class="buttonGroup_fUqw"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_xOtH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SKyo"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_vKap"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_ft1v" id="running-kubectl-commands">Running kubectl commands<a href="#running-kubectl-commands" class="hash-link" aria-label="Direct link to Running kubectl commands" title="Direct link to Running kubectl commands">​</a></h3>
<p>The library provides utilities for running kubectl commands with the correct configuration:</p>
<div class="language-haskell codeBlockContainer_U6bZ theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_I3XA"><pre tabindex="0" class="prism-code language-haskell codeBlock_jAeK thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_XajP"><span class="token-line" style="color:#bfc7d5"><span class="token hvariable">it</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;runs kubectl commands&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token hvariable">kubectlBinary</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token hvariable">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;-</span><span class="token plain"> </span><span class="token hvariable">askKubectlArgs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">pods</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;-</span><span class="token plain"> </span><span class="token hvariable">readCreateProcessWithLogging</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token hvariable">proc</span><span class="token plain"> </span><span class="token hvariable">kubectlBinary</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;get&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;pods&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;-A&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token hvariable">env</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">Just</span><span class="token plain"> </span><span class="token hvariable">env</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">info</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token hvariable">i</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token constant" style="color:rgb(130, 170, 255)">Cluster</span><span class="token plain"> </span><span class="token hvariable">pods</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">#</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token hvariable">pods</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><div class="buttonGroup_fUqw"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_xOtH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SKyo"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_vKap"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_ft1v" id="waiting-for-resources">Waiting for resources<a href="#waiting-for-resources" class="hash-link" aria-label="Direct link to Waiting for resources" title="Direct link to Waiting for resources">​</a></h3>
<p>The library includes utilities for waiting for Kubernetes resources to be ready:</p>
<div class="language-haskell codeBlockContainer_U6bZ theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_I3XA"><pre tabindex="0" class="prism-code language-haskell codeBlock_jAeK thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_XajP"><span class="token-line" style="color:#bfc7d5"><span class="token hvariable">it</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;waits for resources&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- Wait for pods to exist</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">waitForPodsToExist</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;default&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">LabelSelector</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;app&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;my-app&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- Wait for pods to be ready</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">waitForPodsToBeReady</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;default&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">LabelSelector</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;app&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;my-app&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- Wait for service endpoints</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">waitForServiceEndpointsToExist</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;default&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;my-service&quot;</span><br></span></code></pre><div class="buttonGroup_fUqw"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_xOtH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SKyo"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_vKap"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_ft1v" id="image-management">Image management<a href="#image-management" class="hash-link" aria-label="Direct link to Image management" title="Direct link to Image management">​</a></h2>
<p>The library provides <a href="https://hackage-content.haskell.org/package/sandwich-contexts-kubernetes/docs/Test-Sandwich-Contexts-Kubernetes-Images.html" target="_blank" rel="noopener noreferrer">image management</a> for both cluster types. You can load an image onto the cluster directly from your local Docker/Podman system, or from a tarball.</p>
<p>An important thing to understand here is that an image name once it&#x27;s loaded onto the cluster may not be the same as its local name. The <a href="https://hackage-content.haskell.org/package/sandwich-contexts-kubernetes/docs/Test-Sandwich-Contexts-Kubernetes-Images.html#v:loadImage" target="_blank" rel="noopener noreferrer">loadImage</a> function will return the cluster name of the image. This is the name you should use if you proceed to e.g. create a Pod using this image.</p>
<h3 class="anchor anchorWithStickyNavbar_ft1v" id="loading-images">Loading images<a href="#loading-images" class="hash-link" aria-label="Direct link to Loading images" title="Direct link to Loading images">​</a></h3>
<div class="language-haskell codeBlockContainer_U6bZ theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_I3XA"><pre tabindex="0" class="prism-code language-haskell codeBlock_jAeK thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_XajP"><span class="token-line" style="color:#bfc7d5"><span class="token hvariable">it</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;loads images into cluster&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- Load from Docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">busyBoxImage</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;-</span><span class="token plain"> </span><span class="token hvariable">loadImage</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">ImageLoadSpecDocker</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;busybox:latest&quot;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">IfNotPresent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- Load from Podman</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">nginxImage</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;-</span><span class="token plain"> </span><span class="token hvariable">loadImage</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">ImageLoadSpecPodman</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;nginx:latest&quot;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">Always</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- Load from tarball</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">tarPath</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;-</span><span class="token plain"> </span><span class="token hvariable">buildNixCallPackageDerivation</span><span class="token plain"> </span><span class="token hvariable">myImageDerivation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">tarballImage</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;-</span><span class="token plain"> </span><span class="token hvariable">loadImage</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">ImageLoadSpecTarball</span><span class="token plain"> </span><span class="token hvariable">tarPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- Use these images</span><br></span></code></pre><div class="buttonGroup_fUqw"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_xOtH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SKyo"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_vKap"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_ft1v" id="checking-loaded-images">Checking loaded images<a href="#checking-loaded-images" class="hash-link" aria-label="Direct link to Checking loaded images" title="Direct link to Checking loaded images">​</a></h3>
<div class="language-haskell codeBlockContainer_U6bZ theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_I3XA"><pre tabindex="0" class="prism-code language-haskell codeBlock_jAeK thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_XajP"><span class="token-line" style="color:#bfc7d5"><span class="token hvariable">it</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;checks available images&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">images</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;-</span><span class="token plain"> </span><span class="token hvariable">getLoadedImages</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">forM_</span><span class="token plain"> </span><span class="token hvariable">images</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">\</span><span class="token hvariable">image</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> </span><span class="token hvariable">info</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token hvariable">i</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token constant" style="color:rgb(130, 170, 255)">Available</span><span class="token plain"> </span><span class="token hvariable">image</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">#</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token hvariable">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">hasImage</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;-</span><span class="token plain"> </span><span class="token hvariable">clusterContainsImage</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;busybox:latest&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">hasImage</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">`shouldBe`</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">True</span><br></span></code></pre><div class="buttonGroup_fUqw"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_xOtH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SKyo"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_vKap"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_ft1v" id="service-forwarding-and-port-forwarding">Service forwarding and port forwarding<a href="#service-forwarding-and-port-forwarding" class="hash-link" aria-label="Direct link to Service forwarding and port forwarding" title="Direct link to Service forwarding and port forwarding">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_ft1v" id="service-forwarding">Service forwarding<a href="#service-forwarding" class="hash-link" aria-label="Direct link to Service forwarding" title="Direct link to Service forwarding">​</a></h3>
<p>Forward Kubernetes services to local URLs:</p>
<div class="language-haskell codeBlockContainer_U6bZ theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_I3XA"><pre tabindex="0" class="prism-code language-haskell codeBlock_jAeK thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_XajP"><span class="token-line" style="color:#bfc7d5"><span class="token hvariable">it</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;forwards a service&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">withForwardKubernetesService</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;default&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;my-service&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">\</span><span class="token hvariable">serviceUrl</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token hvariable">info</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token hvariable">i</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token constant" style="color:rgb(130, 170, 255)">Service</span><span class="token plain"> </span><span class="token hvariable">available</span><span class="token plain"> </span><span class="token hvariable">at</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">#</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token hvariable">serviceUrl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- Make requests to the service</span><br></span></code></pre><div class="buttonGroup_fUqw"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_xOtH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SKyo"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_vKap"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_ft1v" id="port-forwarding">Port forwarding<a href="#port-forwarding" class="hash-link" aria-label="Direct link to Port forwarding" title="Direct link to Port forwarding">​</a></h3>
<p>Forward specific pods or services to local ports:</p>
<div class="language-haskell codeBlockContainer_U6bZ theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_I3XA"><pre tabindex="0" class="prism-code language-haskell codeBlock_jAeK thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_XajP"><span class="token-line" style="color:#bfc7d5"><span class="token hvariable">it</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;port forwards to a pod&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">withKubectlPortForward</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;default&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;pod/my-pod&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;8080:80&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">\</span><span class="token hvariable">localPort</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token hvariable">info</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token hvariable">i</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token constant" style="color:rgb(130, 170, 255)">Pod</span><span class="token plain"> </span><span class="token hvariable">forwarded</span><span class="token plain"> </span><span class="token hvariable">to</span><span class="token plain"> </span><span class="token hvariable">local</span><span class="token plain"> </span><span class="token hvariable">port</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">#</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token hvariable">localPort</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- Connect to localhost:localPort</span><br></span></code></pre><div class="buttonGroup_fUqw"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_xOtH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SKyo"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_vKap"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_ft1v" id="namespaces">Namespaces<a href="#namespaces" class="hash-link" aria-label="Direct link to Namespaces" title="Direct link to Namespaces">​</a></h2>
<p>Create and destroy <a href="https://hackage-content.haskell.org/package/sandwich-contexts-kubernetes/docs/Test-Sandwich-Contexts-Kubernetes-Namespace.html" target="_blank" rel="noopener noreferrer">Kubernetes namespaces</a>:</p>
<div class="language-haskell codeBlockContainer_U6bZ theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_I3XA"><pre tabindex="0" class="prism-code language-haskell codeBlock_jAeK thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_XajP"><span class="token-line" style="color:#bfc7d5"><span class="token hvariable">spec</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">TopSpec</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token hvariable">spec</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token hvariable">introduceKindClusterViaNix</span><span class="token plain"> </span><span class="token hvariable">defaultKindClusterOptions</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">withKubernetesNamespace</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;my-test-namespace&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token hvariable">it</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;runs in custom namespace&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- Tests run within the &quot;my-test-namespace&quot; namespace</span><br></span></code></pre><div class="buttonGroup_fUqw"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_xOtH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SKyo"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_vKap"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_ft1v" id="minio-integration">MinIO integration<a href="#minio-integration" class="hash-link" aria-label="Direct link to MinIO integration" title="Direct link to MinIO integration">​</a></h2>
<p>The library includes built-in support for deploying <a href="https://www.min.io/" target="_blank" rel="noopener noreferrer">MinIO</a> object storage using the <a href="https://docs.min.io/enterprise/aistor-object-store/installation/kubernetes/install/" target="_blank" rel="noopener noreferrer">operator</a>.</p>
<p>Once you deploy the operator, you can create a MinIO server using the <a href="https://hackage-content.haskell.org/package/sandwich-contexts-kubernetes/docs/Test-Sandwich-Contexts-Kubernetes-MinioS3Server.html#v:introduceK8SMinioS3Server" target="_blank" rel="noopener noreferrer">introduceK8SMinioS3Server</a> family of functions.</p>
<div class="language-haskell codeBlockContainer_U6bZ theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_sUAJ">https://github.com/codedownio/sandwich/blob/master/demos/demo-kubernetes-kind/app/Main.hs</div><div class="codeBlockContent_I3XA"><pre tabindex="0" class="prism-code language-haskell codeBlock_jAeK thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_XajP"><span class="token-line" style="color:#bfc7d5"><span class="token hvariable">spec</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">TopSpec</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token hvariable">spec</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token hvariable">introduceKindClusterViaNix</span><span class="token plain"> </span><span class="token hvariable">defaultKindClusterOptions</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">introduceBinaryViaNixPackage</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">@</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;kubectl&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;kubectl&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token hvariable">introduceMinioOperator</span><span class="token plain"> </span><span class="token hvariable">defaultMinioOperatorOptions</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token hvariable">withKubernetesNamespace</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;minio-test&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token hvariable">introduceK8SMinioS3Server</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token hvariable">defaultMinioS3ServerOptions</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;minio-test&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token hvariable">it</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;has MinIO S3 server&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token hvariable">server</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;-</span><span class="token plain"> </span><span class="token hvariable">getContext</span><span class="token plain"> </span><span class="token hvariable">testS3Server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token hvariable">info</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token hvariable">i</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token constant" style="color:rgb(130, 170, 255)">Got</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">S3</span><span class="token plain"> </span><span class="token hvariable">server</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">#</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token hvariable">server</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><div class="buttonGroup_fUqw"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_xOtH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SKyo"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_vKap"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_ft1v" id="logging">Logging<a href="#logging" class="hash-link" aria-label="Direct link to Logging" title="Direct link to Logging">​</a></h2>
<p>The <a href="https://hackage-content.haskell.org/package/sandwich-contexts-kubernetes/docs/Test-Sandwich-Contexts-Kubernetes.html#v:withKubectlLogs" target="_blank" rel="noopener noreferrer">withKubectlLogs</a> function will run a <code>kubectl logs</code> process, placing the logs in a file in the current test node directory.</p>
<p>Note that this will stop working if the pod you&#x27;re talking to goes away (even if you do it against a service). If this happens, a rerun of the command is needed to resume log forwarding.</p>
<div class="language-haskell codeBlockContainer_U6bZ theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_I3XA"><pre tabindex="0" class="prism-code language-haskell codeBlock_jAeK thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_XajP"><span class="token-line" style="color:#bfc7d5"><span class="token hvariable">it</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;gets pod logs&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">logs</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;-</span><span class="token plain"> </span><span class="token hvariable">kubectlLogs</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;default&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;my-pod&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">info</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token hvariable">i</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token constant" style="color:rgb(130, 170, 255)">Pod</span><span class="token plain"> </span><span class="token hvariable">logs</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">#</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token hvariable">logs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- Follow logs in real-time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token hvariable">withKubectlLogs</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;default&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;my-pod&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;-f&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">$</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">\</span><span class="token hvariable">logHandle</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- Process streaming logs</span><br></span></code></pre><div class="buttonGroup_fUqw"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_xOtH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SKyo"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_vKap"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/context-libraries/sandwich-contexts-kubernetes.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_gEVS" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_X6Ll"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/sandwich/docs/context-libraries/sandwich-contexts-smtp"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">SMTP</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/sandwich/docs/context-libraries/sandwich-contexts-minio"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">MinIO</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_nnsz thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#creating-clusters" class="table-of-contents__link toc-highlight">Creating clusters</a><ul><li><a href="#kind-clusters" class="table-of-contents__link toc-highlight">Kind clusters</a></li><li><a href="#minikube-clusters" class="table-of-contents__link toc-highlight">Minikube clusters</a></li></ul></li><li><a href="#working-with-clusters" class="table-of-contents__link toc-highlight">Working with clusters</a><ul><li><a href="#running-kubectl-commands" class="table-of-contents__link toc-highlight">Running kubectl commands</a></li><li><a href="#waiting-for-resources" class="table-of-contents__link toc-highlight">Waiting for resources</a></li></ul></li><li><a href="#image-management" class="table-of-contents__link toc-highlight">Image management</a><ul><li><a href="#loading-images" class="table-of-contents__link toc-highlight">Loading images</a></li><li><a href="#checking-loaded-images" class="table-of-contents__link toc-highlight">Checking loaded images</a></li></ul></li><li><a href="#service-forwarding-and-port-forwarding" class="table-of-contents__link toc-highlight">Service forwarding and port forwarding</a><ul><li><a href="#service-forwarding" class="table-of-contents__link toc-highlight">Service forwarding</a></li><li><a href="#port-forwarding" class="table-of-contents__link toc-highlight">Port forwarding</a></li></ul></li><li><a href="#namespaces" class="table-of-contents__link toc-highlight">Namespaces</a></li><li><a href="#minio-integration" class="table-of-contents__link toc-highlight">MinIO integration</a></li><li><a href="#logging" class="table-of-contents__link toc-highlight">Logging</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/sandwich/docs/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/sandwich/docs/formatters/slack">Slack integration</a></li><li class="footer__item"><a class="footer__link-item" href="/sandwich/docs/extensions/sandwich-webdriver">Selenium integration</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/codedownio/sandwich/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_qMpq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/sandwich/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/codedownio/sandwich" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_qMpq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Tom McLaughlin. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>